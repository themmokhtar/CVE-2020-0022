BUILDDIR = build
SOURCEDIR = src
INCLUDEDIR = include

INCLUDES = -Iinclude -Iinclude/**
LIBRARIES = -lbluetooth

COMPILE = $(CC) $(CFLAGS) $(INCLUDES) -Wall

DEPS = $(wildcard $(SOURCEDIR)/*.c)
OBJS = $(patsubst $(SOURCEDIR)/%.c,$(BUILDDIR)/%.o,$(DEPS))
HEADERS = $(wildcard $(INCLUDEDIR)/*.h)

.PHONY: all build run clean

build: $(BUILDDIR)/exploit.out

$(BUILDDIR)/exploit.out: $(OBJS)
	$(COMPILE) -o $@ $^ $(LIBRARIES)

$(BUILDDIR)/%.o: $(SOURCEDIR)/%.c $(HEADERS)
	$(COMPILE) -c -o $@ $< $(LIBRARIES)

run:
	sudo systemctl restart bluetooth.service
	sleep 1

	@printf "\nRunning exploit...\n\n"
	sudo ./exploit $(ARGS)

all: build run

clean:
	rm -f $(BUILDDIR)/*.o $(BUILDDIR)/exploit.out

